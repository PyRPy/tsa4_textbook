---
title: "tsaEZ notes"
author: "ETF Researcher"
date: "March 11, 2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
* tsaEZ® http://www.stat.pitt.edu/stoffer/tsa4/

```{r}
# load package
library(astsa)
```
# Time Series Characteristics

## Example 1.7 Moving Averages and Filtering
```{r}
w = rnorm(500, 0, 1)
v = filter(w, sides = 2, rep(1/3, 3))
par(mfrow = c(2,1))
tsplot(w, main = "white noise")
tsplot(v, ylim = c(-3, 3),main = "moving average")
```

## Example 1.8 Autoregressions
```{r}
w = rnorm(550, 0, 1)
x = filter(w, filter = c(1, -0.9), method = "recursive")[-(1:50)]
tsplot(x, main = "autoregression")
```

## Example 1.9 Random Walk with Drift
```{r}
set.seed(154)
w = rnorm(200)
x = cumsum(w)
wd = w + 0.2
xd = cumsum(wd)

tsplot(xd, ylim = c(-5, 55), main = "random walk", ylab = "")
abline(a = 0, b = 0.2, lty = 2)
lines(x, col = 4)
abline(h = 9, col = 4, lty = 2)
```

## Example 1.22 Prediction Using Cross-Correlation
```{r}
x = rnorm(100)
y = lag(x, -5) + rnorm(100)
ccf(y, x, ylab = 'CCovF', type = 'covariance')
```

# 2.2 Exploratory Data Analysis

## Example 2.5 Differencing Chicken Prices
```{r}
fit <- lm(chicken ~ time(chicken), na.action = NULL)
par(mfrow = c(2, 1))
tsplot(resid(fit), main = "detrend")
tsplot(diff(chicken), main = 'first difference')
```

```{r}
par(mfrow = c(3, 1))
acf1(chicken, 48, main = 'chiken')
acf1(resid(fit), 48, main = 'detrended')
acf1(diff(chicken), 48, main = 'first difference')
```

## Example 2.7 Paleoclimatic Glacial Varves (transformation)
```{r}
par(mfrow = c(2, 1))
tsplot(varve, main = "varve", ylab = "")
tsplot(log(varve), main = "log(varve)", ylab = "")
```

## Example 2.8 Scatterplot Matrices, SOI and Recruitment

```{r}
lag1.plot(soi, 12)
```
```{r}
lag2.plot(soi, rec, 8)
```

## Example 2.9 Regression with Lagged Variables (cont)
```{r}
dummy = ifelse(soi < 0, 0, 1)
fish = ts.intersect(rec, soiL6 = lag(soi, -6), dL6 = lag(dummy, -6), dframe = TRUE)
summary(fit <- lm(rec ~ soiL6*dL6, data = fish, na.action = NULL))
```
```{r}
attach(fish)
plot(soiL6, rec)
lines(lowess(soiL6, rec), col= 4, lwd=2)
points(soiL6, fitted(fit), pch="+", col= 2)
```
```{r}
tsplot(resid(fit))
acf(resid(fit))
```

## Example 2.10 Using Regression to Discover a Signal in Noise
```{r}
set.seed(90210) # so you can reproduce these results
x = 2*cos(2*pi*1:500/50 + .6*pi) + rnorm(500,0,5)
z1 = cos(2*pi*1:500/50)
z2 = sin(2*pi*1:500/50)
summary(fit <- lm(x~ 0 + z1 + z2)) # zero to exclude the intercept
```
```{r}
par(mfrow=c(2,1))
tsplot(x, margins=.25)
tsplot(x, col=8, margins=.25, ylab=expression(hat(x)))
lines(fitted(fit), col=2)

```

## 2.3 Smoothing Time Series

## Example 2.11 Moving Average Smoother
```{r}
wgts = c(.5, rep(1,11), .5)/12
soif = filter(soi, sides=2, filter=wgts)
tsplot(soi)
lines(soif, lwd=2, col=4)
```

## Example 2.12 Kernel Smoothing
```{r}
tsplot(soi)
lines(ksmooth(time(soi), soi, "normal", bandwidth=1), lwd=2, col=4)
SOI = ts(soi, freq=1); tsplot(SOI) # the time scale matters (not shown)
lines(ksmooth(time(SOI), SOI, "normal", bandwidth=12), lwd=2, col=4)

```

## Example 2.13 Lowess
```{r}
tsplot(soi)
lines(lowess(soi, f=.05), lwd=2, col=4) # El Nino cycle
lines(lowess(soi), lty=2, lwd=2, col=2) # trend (using default span)

```

## Example 2.15 Classical Structural Modeling
```{r}
x = window(hor, start=2002) # data set in astsa version 1.7.1+
plot(decompose(x)) # not shown
plot(stl(x, s.window='per')) # not shown
plot(stl(x, s.window=15))

```

